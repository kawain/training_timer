<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>筋トレ・タイマー</title>
    <style>
        body {
            background-color: white;
            color: black;
        }

        h1,
        h2 {
            text-align: center;
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            display: flex;
            gap: 30px;
        }

        .box1 {
            flex: 1;
        }

        .timer {
            text-align: center;
            font-size: 4rem;
            font-weight: bold;
            color: red;
            margin: 20px 0;
        }

        .btn {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        button {
            padding: 5px;
        }

        .box2 {
            flex: 2;
        }

        label {
            display: block;
            font-size: 1.3rem;
            padding: 5px 0;
        }

    </style>
</head>

<body>
    <div class="container">
        <div class="box1">
            <h1>筋トレ・タイマー</h1>
            <div class="timer">
                <span id="minutes">0</span>:<span id="seconds">00</span>
            </div>
            <div class="btn">
                <button id="startButton">スタート</button>
                <button id="stopButton">停止</button>
                <button id="resetButton">リセット</button>
            </div>
            <ul>
                <li>checkしたものはlocalStorageに保存。<span id="period">72</span>時間表示しない</li>
            </ul>
        </div>
        <div class="box2">
            <h2>種目</h2>
            <div class="itemBox">
            </div>
        </div>
    </div>

    <script>
        const items = [
            // 基本
            ["スクワット", "膝を直角以上に曲げない。膝がつま先より前に出ないようにお尻を突き出す。膝はつま先と同じ方向に曲げる。"],
            ["シングルレッグカーフレイズ", "壁に手を付き、片足をもう片方の足に掛けた姿勢から爪先立ちになり、かかとを上下させる。ふくらはぎの筋トレ。"],
            ["プッシュアップ", "前ならえをした状態で、手を2つ分外側にした状態の腕立て伏せ"],
            ["クランチ", "仰向けで寝て、太ももが床から直角になる位置に上げ、足先は膝よりやや上で、両足は揃える。頭は床につけない。腕は胸でクロスさせる。上半身を丸めて起こす感じ。肩甲骨が床から離れるまで起こす。顎は下げる。腹筋は息を吐く。"],
            ["リバースクランチ", "クランチの姿勢で、お尻を床から上げて、両膝を肩に最も近づくように持って来る。戻す時足は床につけない。頭は床につけない。腕は体側。"],
            ["レッグレイズ", "仰向けに寝て、両脚は揃えて上下に動かす。床に足はつけない。"],
            ["バックエクステンション", "うつ伏せの状態になり、手の平は上を向け両手は体の横（負荷を与えたければ腕を前に伸ばす）、息を吐きながら、無理なく上がる高さまで上体を上げ下げする。上げた時に手の平を回してもいい。頭は床をずっと見る。頭を上げない。"],
            ["ショルダープレス（チューブ）", "座ってダンベルを上下するように肩を鍛える。"],
            ["サイドレイズ（チューブ）", "立ってチューブを踏んで腕は曲げないで真横に上下するように肩を鍛える。"],
            ["デッドリフト（チューブ）", "背中"],
            ["アームカール（チューブ）", "上腕二頭筋"],

            // その他
            ["バックランジ", "重心は前。姿勢は真っ直ぐ。前膝はつま先より前に出ない。後ろ膝は軽く床につけて一瞬止まる感じ。"],
            ["ブルガリアンスクワット", "片足でスクワット"],
            ["マウンテンクライマー", "腕立て伏せの姿勢で片膝を交互に胸に引きつけて戻す動作。リズムよく。"],
            ["トライアングルプッシュアップ", "お尻を高く上げて、体をくの字の曲げた状態で、親指と人差指で三角形を作り、そこに鼻を入れる容量の腕立て伏せ"],
            ["ワイドプッシュアップ", "前ならえをした状態で、手を3つ分外側にした状態の腕立て伏せ"],
            ["プランクアップダウン", "腕立て伏せの状態で、肩から足までがまっすぐになるように保ちます。右腕を曲げて肘をつき、次に左腕を曲げて肘をつきます。今度は右の肘を上げて手で立ち、左のひじも持ち上げ元の位置に戻ります。"],
            ["サイドプッシュアップ", "横向きになった姿勢で片腕で体を持ち上げる。"],
        ]

        const localStorageKeyName = "myData"
        const period = Number(document.getElementById('period').textContent)
        const itemBox = document.querySelector('.itemBox')
        const minutesDisplay = document.getElementById('minutes')
        const secondsDisplay = document.getElementById('seconds')
        const startButton = document.getElementById('startButton')
        const stopButton = document.getElementById('stopButton')
        const resetButton = document.getElementById('resetButton')
        let beepSound = new Audio('./Hi-Hat-Closed-Hit.mp3')
        let minutes = 0
        let seconds = 0
        let timerInterval
        let running = false


        function addLocalStorage(keyText) {
            const date = new Date()
            // ミリ秒
            const time = date.getTime()
            // ローカルストレージを読み込む
            const data = localStorage.getItem(localStorageKeyName)
            if (data) {
                // オブジェクトに戻す
                const obj = JSON.parse(data)
                // 追加
                obj[keyText] = time
                // 文字列にする
                const json = JSON.stringify(obj)
                // ローカルストレージに書き込む
                localStorage.setItem(localStorageKeyName, json)
            } else {
                // keyに変数展開したいときは[]で変数名を囲う
                // 文字列にする
                const json = JSON.stringify({ [keyText]: time })
                // ローカルストレージに書き込む
                localStorage.setItem(localStorageKeyName, json)
            }
        }

        function delLocalStorage(keyText) {
            // ローカルストレージを読み込む
            const data = localStorage.getItem(localStorageKeyName)
            if (data) {
                // オブジェクトに戻す
                const obj = JSON.parse(data)
                // 新しいオブジェクト
                const newObj = {}
                // キーを反復
                for (const k in obj) {
                    if (k === keyText) {
                        continue
                    } else {
                        newObj[k] = obj[k]
                    }
                }
                // 文字列にする
                const json = JSON.stringify(newObj)
                // ローカルストレージに書き込む
                localStorage.setItem(localStorageKeyName, json)
            }
        }

        function updateLocalStorage() {
            // ローカルストレージを読み込む
            const data = localStorage.getItem(localStorageKeyName)
            if (data) {
                const date = new Date()
                // ミリ秒
                const time = date.getTime()
                // オブジェクトに戻す
                const obj = JSON.parse(data)
                // 新しいオブジェクト
                const newObj = {}
                // キーを反復
                for (const k in obj) {
                    const diff = time - obj[k]
                    const result = Math.floor(diff / (1000 * 60 * 60))
                    if (result >= period) {
                        continue
                    } else {
                        newObj[k] = obj[k]
                    }
                }
                // 文字列にする
                const json = JSON.stringify(newObj)
                // ローカルストレージに書き込む
                localStorage.setItem(localStorageKeyName, json)
            }
        }

        function displayItems() {
            let html = ""
            // ローカルストレージを読み込む
            const data = localStorage.getItem(localStorageKeyName)
            if (data) {
                // オブジェクトに戻す
                const obj = JSON.parse(data)
                // htmlを作る
                for (const v of items) {
                    if (obj[v[0]]) {
                        continue
                    } else {
                        html += `<label><input type="checkbox" class="cb"> ${v[0]}</label><small>${v[1]}</small>`
                    }
                }
            } else {
                for (const v of items) {
                    html += `<label><input type="checkbox" class="cb"> ${v[0]}</label><small>${v[1]}</small>`
                }
            }
            itemBox.innerHTML = html
        }

        function updateTimer() {
            seconds++
            if (seconds >= 60) {
                minutes++
                seconds = 0
            }

            minutesDisplay.textContent = minutes
            secondsDisplay.textContent = seconds < 10 ? `0${seconds}` : seconds

            beepSound.pause()
            beepSound.currentTime = 0
            beepSound.play()
        }

        function startTimer() {
            if (!running) {
                running = true
                // timerInterval = setInterval(updateTimer, 1000)
                timerInterval = setTimeout(function request() {
                    updateTimer()
                    timerInterval = setTimeout(request, 1000)
                }, 1000)
            }
        }

        function stopTimer() {
            running = false
            clearInterval(timerInterval)
            beepSound.pause()
            beepSound.currentTime = 0
        }

        function resetTimer() {
            running = false
            clearInterval(timerInterval)
            minutes = 0
            seconds = 0
            minutesDisplay.textContent = '0'
            secondsDisplay.textContent = '00'
            beepSound.pause()
            beepSound.currentTime = 0
        }

        function onOffCheck(e) {
            let elm = e.target
            if (elm.className === "cb") {
                const keyText = elm.parentNode.textContent.trim()
                if (elm.checked) {
                    addLocalStorage(keyText)
                } else {
                    delLocalStorage(keyText)
                }
            }
        }

        startButton.addEventListener('click', startTimer)
        stopButton.addEventListener('click', stopTimer)
        resetButton.addEventListener('click', resetTimer)
        itemBox.addEventListener('click', onOffCheck)

        // 初回実行
        updateLocalStorage()
        displayItems()

    </script>
</body>

</html>
